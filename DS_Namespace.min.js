var ds=ds||{p:{root:window.location.protocol+'//'+window.location.host+_spPageContextInfo.webServerRelativeUrl,page:window.location.protocol+'//'+window.location.host+_spPageContextInfo.webServerRelativeUrl+_spPageContextInfo.serverRequestPath,pageListName:_spPageContextInfo.serverRequestPath.replace('/Lists/','/').split('/')[1],pageFormName:_spPageContextInfo.serverRequestPath.replace('/Lists/','/').split('/')[2].split('.')[0],userID:_spPageContextInfo.userId,rest:{lists2013:'_api/web/lists',lists2010:'_vti_bin/ListData.svc/'},cdn:{js:{moment:'//momentjs.com/downloads/moment.js',momentTz:'//momentjs.com/downloads/moment-timezone.js',jquery:'//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js',jqueryUi:'//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js',fontAwesome:'//use.fontawesome.com/fa7f1cdf10.js',feedEk:'//cdnjs.cloudflare.com/ajax/libs/FeedEk/3.0.0/js/FeedEk.min.js',jqueryColor:'//code.jquery.com/color/jquery.color-2.1.2.min.js',jqueryEasing:'//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js',jqueryCorner:'//malsup.github.io/jquery.corner.js'},css:{jqueryUi:'//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.css',jqueryUiSmoothness:'//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css',fontAwesome:'//maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css',feedEk:'//cdnjs.cloudflare.com/ajax/libs/FeedEk/3.0.0/css/FeedEk.min.css'}}},repOp:{newObjRO:function(c,d,e,f,g,h){var b=new Date();var a=c+b.valueOf();return ds.repOp[a]===void 0?ds.repOp[a]={name:a,forFx:d,desc:e,ro:null,loopIndex:0,loopsDone:0,loopsToDo:f,bDone:!1,initFx:function(){ds.repOp[a].ro=new ds.repOp.newRO(function(){var b=ds.repOp[a].loopIndex;ds.repOp[a].loopingFx(b),ds.util.log('Repeat Operation |'+a+'| running... at index |'+ds.repOp[a].loopIndex+'|'),ds.repOp[a].loopIndex=ds.repOp[a].loopIndex+1,ds.repOp[a].loopsDone=ds.repOp[a].loopsDone+1,ds.repOp[a].loopsDone<ds.repOp[a].loopsToDo?ds.repOp[a].ro():(ds.repOp[a].bDone=!0,ds.util.log('Repeat Operation |'+a+'| complete'),ds.repOp[a].successFx());},ds.repOp.yieldAfter),ds.repOp[a].ro();},successFx:h,loopingFx:g}:(ds.util.log('A Repeat Operation with that name ('+a+') already exists!',!0),alert('A Repeat Operation with that name ('+a+') already exists!')),a;},newRO:function(b,c){var a=0;return function(){++a>=c?(a=0,ds.util.log('Repeat operation is paused for |'+ds.repOp.pauseBetweenMS+'|ms'),setTimeout(function(){b();},ds.repOp.pauseBetweenMS)):b();};},yieldAfter:2,pauseBetweenMS:173},stor:{SPTZs:{},spCSOM:{clientContext:null,web:null,culture:null,tz:null,siteTzId:null,siteTzDescription:null,siteTzInformation:null},session:{bDebug:!1,bOnlyGetListsWhenTold:!1,idleTime:0,windowScreenX:window.screenX,windowScreenY:window.screenY,pageXScroll:window.pageXOffset,pageYScroll:window.pageYOffset,windowWidth:window.outerWidth,windowHeight:window.outerHeight,mouseX:0,mouseY:0,lastControl:null,windowFocus:!0,onSetupPage:!1,onConfigPage:!1,onTaskDisplayForm:!1,onTaskEditForm:!1},formSettings:null,existingFormSettings:!1,commonContent:{},listNames:['Intake','Tasks','TaskComments','TaskContacts','TaskStatusHistory','TaskMeetings','TaskTimeEntry'],fieldType:{},listTemplates:{},rss:{},createLists:{},newRelated:{},updateRelated:{}},lists:{},factCheck:{loopThroughKnownFeeds:function(){ds.controls.accordion.arrContent=[],ds.util.log("querying SP list 'factcheckers' to get our known rss fact-checker feeds"),ds.rest.list.getData.fromList('factcheckers',[],[],[],[],function(){ds.util.log('looping through the known rss feeds'),ds.$(ds.lists.factcheckers.items.results).each(function(c,a){var b={};b.Title=a.Title,b.rssurl=a.rssurl,ds.factCheck.getFeedData(a.Title,a.rssurl,b);}),ds.util.log('finished looping through known rss feeds to request data'),ds.controls.accordion.init(function(){$("div[id^='divRss']").each(function(){$('.'+$(this).attr('id')).replaceWith($(this));});});},'');},getFeedData(a,d,e){ds.util.log('function ds.factCeck.getFeedData called...');var c=a;while(a.indexOf(' ')>=0)a=a.replace(' ','');while(a.indexOf('.')>=0)a=a.replace('.','');while(a.indexOf('-')>=0)a=a.replace('-','');var b='divRss'+a;ds.util.appendToMain('<div style="display: inline-block; max-height: 300px; overflow-y: scroll;" id="'+b+'"></div>'),$('#'+b).ready(function(){ds.util.log('about to request rss |'+a+'|'),ds.stor.rss[b]={},$('#'+b).FeedEk({FeedUrl:d,ShowDesc:!0,ShowPubDate:!0,TitleLinkTarget:'_blank',DateFormat:'MM/DD/YYYY',DateFormatLang:'en',MaxCount:50}),ds.util.log('finished getting rss |'+a+'|'),$('#'+b).ready(function(){if(ds.util.log('capturing accordion section for rss |'+a+'|'),ds.controls.accordion.arrContent.length<1)var d={heading:'<i class="fa fa-chevron-down fa-1x"></i>&nbsp;'+c,content:"<div class='"+b+"'></div>"};else var d={heading:'<i class="fa fa-chevron-right fa-1x"></i>&nbsp;'+c,content:"<div class='"+b+"'></div>"};var e=ds.controls.accordion.arrContent;e.push(d),ds.controls.accordion.arrContent=e;});});}},rest:{lastCall:{},lastSubCall:{},getDataFromURI:function(f,d,c,b,a,g,e){if(c===void 0)var c=!0;if(b===void 0)var b=!1;a===void 0&&(b=!0),ds.util.log('ds.rest.getDataFromURI function called with arguments... |'+encodeURI(f)+'|'),ds.$.ajax({url:f,async:c}).fail(function(b,c,a){ds.rest.lastCall.jqXHR=b,ds.rest.lastCall.textStatus=c,ds.rest.lastCall.errorThrown=a,ds.util.log('ds.rest.getDataFromURI function ajax call failed with error ... |'+a+'|');}).done(function(c,f,h){ds.rest.lastCall.textStatus=f,ds.rest.lastCall.jqXHR=h,ds.rest.lastCall.data=c,ds.util.log('ds.rest.getDataFromURI function ajax call done with status ... |'+f+'|'),typeof d==='function'&&d(c,f,h),!c.d.__next===!1?b===!1?ds.rest.getNextPage(c.d.__next,a,g,d,e):ds.intvls[a]!==void 0&&(ds.intvls[a].bDone=!0):ds.intvls[a]!==void 0&&(ds.intvls[a].bDone=!0,typeof e==='function'&&e(a,g));});},getNextPage:function(c,b,a,d,e){ds.util.log('ds.rest.getNextPage function called with arguments... |'+c+'|'),ds.$.ajax({url:c}).fail(function(c,d,a){ds.rest.lastSubCall.jqXHR=c,ds.rest.lastSubCall.textStatus=d,ds.rest.lastSubCall.errorThrown=a,ds.util.log('ds.rest.getNextPage function ajax call failed with error ... |'+a+'|'),ds.intvls[b].bDone=!0;}).done(function(f,g,h){ds.rest.lastSubCall.textStatus=g,ds.rest.lastSubCall.jqXHR=h,ds.rest.lastSubCall.data=f,ds.util.log('ds.rest.getNextPage function ajax call done with status ... |'+g+'|'),typeof d==='function'&&d(f,g,h),!f.d.__next===!1?(!a===!1&&(ds.lists[a].items.uri=f.d.__next),ds.rest.getNextPage(f.d.__next,b,a,d,e)):(!a===!1&&(ds.lists[a].items.uri=c),ds.intvls[b]!==void 0&&(ds.intvls[b].bDone=!0,typeof e==='function'&&e(b,a)));});},captureDataFromURI:function(restURL,fxCallback,bAsync,bIgnoreNextPage,intvl,listName,strCaptureResultsIn,fxAfterLastPage){if(typeof bAsync==='undefined')var bAsync=!0;if(typeof bIgnoreNextPage==='undefined')var bIgnoreNextPage=!1;if(typeof strCaptureResultsIn==='undefined')var strCaptureResultsIn='ds.lists['+listName+'].items.results';else eval(strCaptureResultsIn)===void 0&&eval(strCaptureResultsIn+' = [];');if(typeof fxAfterLastPage==='undefined')var fxAfterLastPage=function(a,b,c){ds.util.log('Finished capturing last page of REST results for interval'+a,!0),ds.intvls[a].bDone=!0;};ds.util.log('ds.rest.captureDataFromURI function called with arguments... |'+restURL+'|',!0),ds.$.ajax({url:restURL,async:bAsync}).fail(function(a,b,c){ds.rest.lastCall.jqXHR=a,ds.rest.lastCall.textStatus=b,ds.rest.lastCall.errorThrown=c;}).done(function(data,textStatus,jqXHR){ds.rest.lastCall.textStatus=textStatus,ds.rest.lastCall.jqXHR=jqXHR,ds.rest.lastCall.data=data,typeof eval(strCaptureResultsIn)==='object'&&ds.$(data.d.results).each(function(i,elm){eval(strCaptureResultsIn+'.push('+elm+');');}),typeof fxCallback==='function'&&fxCallback(data,textStatus,jqXHR),!data.d.__next===!1?bIgnoreNextPage===!1?ds.rest.captureNextPage(data.d.__next,intvl,listName,fxCallback,fxAfterLastPage):typeof intvl!=='undefined'&&(ds.intvls[intvl].bDone=!0):typeof fxAfterLastPage!=='function'&&typeof intvl!=='undefined'&&(ds.intvls[intvl].bDone=!0),typeof fxAfterLastPage==='function'&&fxAfterLastPage(intvl,listName,strCaptureResultsIn);});},captureNextPage:function(restURL,intvl,listName,strCaptureResultsIn,fxAfterLastPage){if(ds.util.log('ds.rest.getNextPage function called with arguments... |'+restURL+'|',!0),typeof strCaptureResultsIn==='undefined'&&!listName===!1)var strCaptureResultsIn='ds.lists['+listName+'].items.results';if(typeof fxAfterLastPage==='undefined')var fxAfterLastPage=function(a,b,c){ds.util.log('Finished getting last page of REST results for interval'+a,!0),ds.intvls[a].bDone=!0;};ds.$.ajax({url:restURL}).fail(function(a,b,c){ds.rest.lastSubCall.jqXHR=a,ds.rest.lastSubCall.textStatus=b,ds.rest.lastSubCall.errorThrown=c,ds.intvls[intvl].bDone=!0;}).done(function(data,textStatus,jqXHR){ds.rest.lastSubCall.textStatus=textStatus,ds.rest.lastSubCall.jqXHR=jqXHR,ds.rest.lastSubCall.data=data,typeof eval(strCaptureResultsIn)==='object'&&ds.$(data.d.results).each(function(i,elm){eval(strCaptureResultsIn+'.push('+elm+');');}),typeof fxCallback==='function'&&fxCallback(data,textStatus,jqXHR),!data.d.__next===!1?bIgnoreNextPage===!1?ds.rest.captureNextPage(data.d.__next,intvl,listName,fxCallback,fxAfterLastPage):typeof intvl!=='undefined'&&(ds.intvls[intvl].bDone=!0):typeof fxAfterLastPage!=='function'&&typeof intvl!=='undefined'&&(ds.intvls[intvl].bDone=!0),typeof fxAfterLastPage==='function'&&fxAfterLastPage(intvl,listName,strCaptureResultsIn);});},buildRestURL:function(h,d,f,e,c,g){var b=h;if(typeof d==='object'&&typeof f==='object'&&typeof e==='object')if(typeof c==='object'&&c.length+1===e.length){b+='/?$filter=';for(var a=0;a<d.length;a++)b+=d[a]+' '+f[a]+' '+e[a],c.length>1&&a<c.length&&(b+=' '+c[a]+' ');}else if(c===void 0){b+='/?$filter=';for(var a=0;a<d.length;a++)b+=d[a]+' '+f[a]+' '+e[a];}return!g===!1&&(b.indexOf('?')<0?b+='?'+g:b+='&'+g),b;},aggregateByDistinctValuesAsync:function(b,e,f,a,g,h,j){var c={};if(h===void 0)var h=ds.lists[b].Items.__deferred.uri;var d=ds.intvls.newIntvl('wfXHR_getDataFromURI_'+b);ds.intvls[d].pauseMS=100,ds.intvls[d].forFx='ds.rest.getDataFromURI("'+h+'")',ds.intvls[d].desc=e,ds.intvls[d].doWorkFx=function(){return ds.intvls[d].bDone;},ds.intvls[d].successFx=function(){ds.util.log('all done with aggregateByDistinctValues'),ds.util.log(c),typeof j==='function'&&j(c);},ds.lists[b].items={},ds.lists[b].items.results=[],ds.intvls[d].intvl=setInterval(ds.intvls[d].loopingFx,ds.intvls[d].pauseMS);var k=function(c,d,e){for(var a=0;a<c.d.results.length;a++)ds.lists[b].items.results.push(c.d.results[a]);};var i=function(l,m,n){ds.util.log('Handling all pages of returned results ('+ds.lists[b].items.results.length+')',!0);for(var j=0;j<ds.lists[b].items.results.length;j++){ds.util.log(ds.lists[b].items.results[j].Id);var h='';if(typeof e==='object')for(var k=0;k<e.length;k++)k===0?!f[k]===!1&&typeof f[k]==='function'?h+=f[k](ds.lists[b].items.results[j][e[k]]):h+=ds.lists[b].items.results[j][e[k]]:!f[k]===!1&&typeof f[k]==='function'?h+='|'+f[k](ds.lists[b].items.results[j][e[k]]):h+='|'+ds.lists[b].items.results[j][e[k]];else!f[0]===!1&&typeof f[0]==='function'?h=f[0](ds.lists[b].items.results[j][e]):h=ds.lists[b].items.results[j][e];if(c[h]===void 0)if(typeof a==='object'){c[h]={};for(var i=0;i<a.length;i++){c[h][a[i]]===void 0&&(c[h][a[i]]=0);switch(a[i]){case'count':c[h][a[i]]=1;break;case'sum':c[h][a[i]]=parseInt(ds.lists[b].items.results[j][g[i]],10);break;case'average':c[h][a[i]]=[parseInt(ds.lists[b].items.results[j][g[i]],10),1];break;default:ds.util.log('Unknown operator type |'+a+'|');}}}else switch(a){case'count':c[h]=1;break;case'sum':c[h]=parseInt(ds.lists[b].items.results[j][g],10);break;case'average':c[h]=[parseInt(ds.lists[b].items.results[j][g],10),1];break;default:ds.util.log('Unknown operator type |'+a+'|');}else if(typeof a==='object')for(var i=0;i<a.length;i++){c[h][a[i]]===void 0&&(c[h][a[i]]=0);switch(a[i]){case'count':c[h][a[i]]++;break;case'sum':c[h][a[i]]+=parseInt(ds.lists[b].items.results[j][g[i]],10);break;case'average':c[h][a[i]][0]+=parseInt(ds.lists[b].items.results[j][g[i]],10);c[h][a[i]][1]++;break;default:ds.util.log('Unknown operator type |'+a+'|');}}else switch(a){case'count':c[h]++;break;case'sum':c[h]+=parseInt(ds.lists[b].items.results[j][g],10);break;case'average':c[h][0]+=parseInt(ds.lists[b].items.results[j][g],10);c[h][1]++;break;default:ds.util.log('Unknown operator type |'+a+'|');}}ds.intvls[d].bDone=!0;};ds.rest.getDataFromURI(h,k,!0,!1,d,b,i);},list:{field:{getDef:function(a,b,c){},add:function(b,f,g,h,c,d){var a={parameters:{}};var e={__metadata:{type:'SP.FieldCreationInformation'},Title:f,FieldTypeKind:ds.stor.fieldType[g],Required:h};if(!c===!1)for(fd in c)e[fd]=c[fd];return a.parameters=e,intvl=ds.intvls.newIntvl('wfXHR'),ds.intvls[intvl].pauseMS=100,ds.intvls[intvl].forFx='ds.rest.list.field.add("'+JSON.stringify(a)+', '+b+'")',ds.intvls[intvl].desc='Do we have an afterFx? '+typeof d,ds.intvls[intvl].doWorkFx=function(){return ds.intvls[intvl].bDone;},typeof d==='function'&&(ds.intvls[intvl].successFx=d),ds.intvls[intvl].intvl=setInterval(ds.intvls[intvl].loopingFx,ds.intvls[intvl].pauseMS),ds.rest.lastCall={jqXHR:null,data:null,status:null,url:ds.p.root+ds.p.rest.lists2013+"(guid'"+b+"')/fields/addfield"},ds.$.ajax({url:ds.p.root+ds.p.rest.lists2013+"(guid'"+b+"')/fields/addfield",method:'POST',data:JSON.stringify(a)}).fail(function(a,b,c){ds.rest.lastCall.status=b,ds.rest.lastCall.jqXHR=a,ds.intvls[intvl].bDone=!0;}).done(function(a,b,c){ds.rest.lastCall.data=a,ds.rest.lastCall.status=b,ds.rest.lastCall.jqXHR=c,ds.intvls[intvl].bDone=!0;});},change:function(b,e,f,c,d){var a={__metadata:{type:'SP.Field'},Title:f};if(!c===!1)for(fd in c)a[fd]=c[fd];return intvl=ds.intvls.newIntvl('wfXHR'),ds.intvls[intvl].pauseMS=100,ds.intvls[intvl].forFx='ds.rest.list.field.change("'+JSON.stringify(a)+', '+b+'")',ds.intvls[intvl].desc='Do we have an afterFx? '+typeof d,ds.intvls[intvl].doWorkFx=function(){return ds.intvls[intvl].bDone;},typeof d==='function'&&(ds.intvls[intvl].successFx=d),ds.intvls[intvl].intvl=setInterval(ds.intvls[intvl].loopingFx,ds.intvls[intvl].pauseMS),ds.rest.lastCall={jqXHR:null,data:null,status:null,url:ds.p.root+ds.p.rest.lists2013+"(guid'"+b+"')/fields('"+e+"')"},ds.$.ajax({url:ds.p.root+ds.p.rest.lists2013+"(guid'"+b+"')/fields('"+e+"')",method:'POST',data:JSON.stringify(a)}).fail(function(a,b,c){ds.rest.lastCall.status=b,ds.rest.lastCall.jqXHR=a,ds.intvls[intvl].bDone=!0;}).done(function(a,b,c){ds.rest.lastCall.data=a,ds.rest.lastCall.status=b,ds.rest.lastCall.jqXHR=c,ds.intvls[intvl].bDone=!0;});}},item:{add:function(i,b,g){var e='';var a=null;var c=ds.p.root+ds.p.rest.lists2013;var d;var h=null;SP.Guid.isValid(b)===!0?(c+="(guid'"+b+"')",d=ds.util.findList('Id',b),typeof d==='object'&&(e=d.ListItemEntityTypeFullName)):(c+="/GetByTitle('"+b+"')",typeof ds.lists[b]==='object'&&(d=ds.lists[b],e=d.ListItemEntityTypeFullName)),c+='/items',a=ds.intvls.newIntvl('wfXHR_ds.rest.list.item.add');var f=ds.$.extend({__metadata:{type:e}},i);ds.rest.lastCall={jqXHR:null,data:null,status:null,url:c},ds.rest.lastCall.payload=JSON.stringify(f),ds.intvls[a].pauseMS=100,ds.intvls[a].forFx='ds.rest.list.item.update("'+JSON.stringify(f)+', '+b+'")',ds.intvls[a].desc='Do we have an afterFx? '+typeof g,ds.intvls[a].doWorkFx=function(){return ds.intvls[a].bDone;},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS),ds.$.ajax({url:c,data:JSON.stringify(f),contentType:'application/json;odata=verbose',headers:{'IF-MATCH':'*'},dataType:'json',method:'POST'}).fail(function(b,c,d){ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=b,ds.intvls[a].bDone=!0,ds.util.log('ds.rest.item.add call failed with error |'+d+'|',!0);}).done(function(b,c,d){try{ds.rest.lastCall.data=b;}catch(err){ds.util.log('ds.rest.list.item.add method could not capture data in ds.rest.lastCall',true);}ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=d;try{h=b.d;}catch(err){ds.util.log('ds.rest.list.item.add method could not capture data in local variable createdListItem',true);}if(typeof g==='function')try{g(b,c,d);}catch(err){ds.util.log('ds.rest.list.item.add method could not call afterFx and pass data, textStatus, jqXHR parameters',true);afterFx();}ds.intvls[a].bDone=!0;});},delete:function(e,b,f){var c=ds.p.root+ds.p.rest.lists2013;var a=null;var g='';var d;SP.Guid.isValid(b)===!0?(c+="(guid'"+b+"')/items("+e+')',d=ds.util.findList('Id',b),typeof d==='object'&&(g=d.ListItemEntityTypeFullName)):(c+="/GetByTitle('"+b+"')/items("+e+')',typeof ds.lists[b]==='object'&&(d=ds.lists[b],g=d.ListItemEntityTypeFullName)),a=ds.intvls.newIntvl('wfXHR_ds.rest.list.item.delete'),ds.rest.lastCall={jqXHR:null,data:null,status:null,url:c},ds.intvls[a].pauseMS=73,ds.intvls[a].forFx='ds.rest.list.item.delete("'+e+'", "'+b+'", "afterFx")',ds.intvls[a].desc='Do we have an afterFx? '+typeof f,ds.intvls[a].doWorkFx=function(){return ds.intvls[a].bDone;},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS),ds.$.ajax({url:c,type:'DELETE',headers:{'IF-MATCH':'*'}}).fail(function(b,c,d){ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=b,ds.intvls[a].bDone=!0,ds.util.log('ds.rest.item.delete call failed with error |'+d+'|',!0);}).done(function(b,c,d){try{ds.rest.lastCall.data=b;}catch(err){ds.util.log('ds.rest.list.item.delete method could not capture data in ds.rest.lastCall',true);}if(ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=d,typeof f==='function')try{f(b,c,d);}catch(err){ds.util.log('ds.rest.list.item.delete method could not call afterFx and pass data, textStatus, jqXHR parameters',true);afterFx();}ds.intvls[a].bDone=!0;});},update:function(i,b,j,g){var h=null;var f='';var a=null;var c=ds.p.root+ds.p.rest.lists2013;var d;SP.Guid.isValid(b)===!0?(c+="(guid'"+b+"')",d=ds.util.findList('Id',b),typeof d==='object'&&(f=d.ListItemEntityTypeFullName)):(c+="/GetByTitle('"+b+"')",typeof ds.lists[b]==='object'&&(d=ds.lists[b],f=d.ListItemEntityTypeFullName)),c+='/items('+j+')',a=ds.intvls.newIntvl('wfXHR_ds.rest.list.item.update');var e=ds.$.extend({__metadata:{type:f}},i);ds.rest.lastCall={jqXHR:null,data:null,status:null,url:c},ds.rest.lastCall.payload=JSON.stringify(e),ds.intvls[a].pauseMS=100,ds.intvls[a].forFx='ds.rest.list.item.update("'+JSON.stringify(e)+', '+b+'")',ds.intvls[a].desc='Do we have an afterFx? '+typeof g,ds.intvls[a].doWorkFx=function(){return ds.intvls[a].bDone;},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS),ds.$.ajax({url:c,data:JSON.stringify(e),headers:{'IF-MATCH':'*','X-HTTP-Method':'MERGE'},dataType:'json',method:'POST'}).fail(function(b,c,d){ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=b,ds.intvls[a].bDone=!0,ds.util.log('ds.rest.item.update call failed with error |'+d+'|',!0);}).done(function(b,c,d){try{ds.rest.lastCall.data=b;}catch(err){ds.util.log('ds.rest.list.item.update method could not capture data in ds.rest.lastCall',true);}ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=d;try{h=b.d;}catch(err){ds.util.log('ds.rest.list.item.update method could not capture data in local variable updatedListItem',true);}if(typeof g==='function')try{g(b,c,d);}catch(err){ds.util.log('ds.rest.list.item.update method could not call afterFx and pass data, textStatus, jqXHR parameters',true);afterFx();}ds.intvls[a].bDone=!0;});}},getItemType:function(a){return'SP.Data.'+a[0].toUpperCase()+a.substring(1)+'ListItem';},getDef:function(b,j,e){if(e===void 0)var e=!1;var a=null;var c='';var d=ds.p.root+ds.p.rest.lists2013;var f=!1;var i;if(SP.Guid.isValid(b)===!0){d+="('"+b+"')";for(var g=0;g<ds.stor.listNames.length;g++){var h=ds.stor.listNames[g];if(ds.lists[h].def.Id===b){f=!0,i=ds.lists[h].def;break;}}}else d+="/GetByTitle('"+b+"')",typeof ds.lists[b]==='object'&&(f===!0,i=ds.lists[b]);return f===!0?i:(a=ds.intvls.newIntvl('wfXHR_ds.rest.list.getDef'),ds.intvls[a].pauseMS=100,ds.intvls[a].forFx='ds.rest.list.getDef("'+b+'")',ds.intvls[a].desc='Do we have an afterFx? '+typeof j,ds.intvls[a].doWorkFx=function(){return ds.intvls[a].bDone;},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS),ds.rest.lastCall.url=d,ds.rest.lastCall.data=null,ds.rest.lastCall.textStatus=null,ds.rest.lastCall.jqXHR=null,ds.rest.getDataFromURI(d,function(b,d,f){c=b.d.Title.toLowerCase().replace(' ','').replace(' ',''),ds.lists[c]=b.d,e===!0&&ds.rest.coll.getListFields(c,b.d.Fields.__deferred.uri),typeof j==='function'&&j(c),ds.intvls[a].bDone=!0;},!0,!0),!0);},getData:{fromList:function(d,g,i,j,f,e,h){var b=ds.p.root+ds.p.rest.lists2013+"/GetByTitle('"+d+"')/items";var c=d.toLowerCase().replace(' ','').replace(' ','').replace(' ','');var a=null;b=ds.rest.buildRestURL(b,g,i,j,f,h),ds.util.log(b),a=ds.intvls.newIntvl('wfXHR_getDataFromList_'+d),ds.intvls[a].pauseMS=100,ds.intvls[a].forFx='ds.rest.list.getData.fromList("'+d+'")...URL = |'+b+'|',ds.intvls[a].desc='Do we have an afterFx? '+typeof e,ds.intvls[a].doWorkFx=function(){return ds.intvls[a].bDone;},ds.lists[c].items={},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS),ds.$.ajax({url:b,dataType:'json',method:'GET'}).fail(function(b,c,d){ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=b,ds.intvls[a].bDone=!0;}).done(function(d,f,g){ds.rest.lastCall.textStatus=f,ds.rest.lastCall.jqXHR=g,ds.rest.lastCall.data=d,ds.lists[c].items.results=d.d.results,!d.d.__next===!1?(ds.lists[c].items.uri=d.d.__next,ds.rest.getNextPage(d.d.__next,a,c)):(ds.lists[c].items.uri=b,ds.intvls[a].bDone=!0),typeof e==='function'&&e(d,f,g);});}},create:function(d,a,e,b){var c={__metadata:{type:'SP.List'},AllowContentTypes:!0,BaseTemplate:d,ContentTypesEnabled:!0,Description:e,Title:a};return ds.rest.lastCall={jqXHR:null,data:null,status:null,url:ds.p.root+ds.p.rest.lists2013},ds.$.ajax({url:ds.p.root+ds.p.rest.lists2013,method:'POST',data:JSON.stringify(c)}).done(function(d,e,c){ds.rest.lastCall.status=e,ds.rest.lastCall.data=d,ds.rest.lastCall.jqXHR=c,ds.lists[a]=ds.lists[a]||{},ds.lists[a].Title=c.responseJSON.d.Title,ds.lists[a].Id=c.responseJSON.d.Id,ds.lists[a].BaseTemplate=c.responseJSON.d.BaseTemplate,ds.lists[a].BaseType=c.responseJSON.d.BaseType,ds.lists[a].EnableAttachments=c.responseJSON.d.EnableAttachments,ds.lists[a].EnableVersioning=c.responseJSON.d.EnableVersioning,ds.lists[a].Description=c.responseJSON.d.Description,ds.lists[a].DefaultView=c.responseJSON.d.DefaultView.__deferred.uri,ds.lists[a].ItemCount=c.responseJSON.d.ItemCount,ds.lists[a].Items=c.responseJSON.d.Items.__deferred.uri,ds.lists[a].Forms=c.responseJSON.d.Forms.__deferred.uri,ds.lists[a].Fields=c.responseJSON.d.Fields.__deferred.uri,ds.util.log('List created via REST',!0),typeof b==='function'&&b(d,e,c);});},update:function(c,d,e){var a={__metadata:{type:'SP.List'}};for(setting in d)a[setting]=d[setting];var b=ds.p.root+ds.p.rest.lists2013+"/GetByTitle('"+c+"')";return ds.rest.lastCall={jqXHR:null,data:null,status:null,url:b},ds.$.ajax({url:b,type:'POST',data:JSON.stringify(a),headers:{'X-HTTP-Method':'MERGE','IF-MATCH':'*'}}).fail(function(a,b,c){ds.rest.lastCall.textStatus=b,ds.rest.lastCall.jqXHR=a;}).done(function(b,d,a){ds.rest.lastCall.status=d,ds.rest.lastCall.data=b,ds.rest.lastCall.jqXHR=a;try{ds.lists[c].EnableVersioning=a.responseJSON.d.EnableVersioning;}catch(err){}ds.util.log('List updated via REST',!0),typeof e==='function'&&e(b,d,a);});},addField:function(e,d,c,i,j,g,h,f){ds.util.log('ds.rest.list.addField called for listGUID |'+e+'|');var a={__metadata:{type:'SP.Field'},Title:d,FieldTypeKind:c,Required:i,EnforceUniqueValues:j,StaticName:g};var b=ds.p.root+ds.p.rest.lists2013+"(guid'"+e+"')/Fields";if(c===7){var a={parameters:{__metadata:{type:'SP.FieldCreationInformation'},Title:d,FieldTypeKind:c,LookupListId:h,LookupFieldName:'Title'}};b+='/addField';}return ds.rest.lastCall={jqXHR:null,data:null,status:null,url:ds.p.root+ds.p.rest.lists2013},ds.$.ajax({url:b,method:'POST',data:JSON.stringify(a)}).done(function(a,b,c){ds.rest.lastCall.status=b,ds.rest.lastCall.data=a,ds.rest.lastCall.jqXHR=c,ds.util.log('List field added via REST',!0),typeof f==='function'&&f(a,b,c);});}},coll:{getLists:function(b,a){return ds.util.log('Requesting definitions for all lists and libraries in this site'),ds.$.ajax({url:ds.p.root+ds.p.rest.lists2013,dataType:'json',method:'GET'}).fail(function(a,b,c){ds.rest.lastCall.jqXHR=a,ds.rest.lastCall.textStatus=b,ds.rest.lastCall.errorThrown=c,ds.util.log('Failed to get definitions for all lists and libraries in this site');}).done(function(d,f,g){ds.rest.lastCall.data=d,ds.rest.lastCall.textStatus=f,ds.rest.lastCall.jqXHR=g;for(var e=0;e<d.d.results.length;e++)try{var h=d.d.results[e].Id;var c=d.d.results[e].Title.replace(' ','').replace(' ','').toLowerCase();ds.lists[c]=d.d.results[e],ds.lists[c].gotDef=!0,ds.util.log('Got list definition for list |'+c+'|'),ds.lists[c].gotFields=!1,b===!0&&d.d.results[e].Hidden===!1?(ds.util.log('Requesting field definitions for list |'+c+'|'),ds.rest.coll.expandListDef(c,ds.p.root+ds.p.rest.lists2013+"('"+h+"')")):ds.lists[c].gotFields=!0;}catch(err){}typeof a==='function'&&a(d,f,g);});},expandListDef:function(a,c,d){if(a!=='userinformationlist')var b=c+'?$select=EffectiveBasePermissions,Fields,Views,items,items/EffectiveBasePermissions&$expand=items,Fields,Views,Views/ViewFields';else var b=c+'?$select=Fields,Views,items&$expand=items,Fields,Views,Views/ViewFields';ds.util.log('ds.rest.coll.expandListDef function about to call REST URL... '+b),ds.rest.getDataFromURI(b,function(b,c,e){ds.util.log('ds.rest.getDataFromURI function got server response with status |'+c+'|'),ds.util.log('Expanded list def: '+a),ds.lists[a].fields_def=b.d.Fields;try{ds.lists[a].EffectiveBasePermissions=b.d.EffectiveBasePermissions;}catch(err){}ds.lists[a].items=b.d.Items,ds.lists[a].Views=b.d.Views,typeof d==='function'&&d(b,c,e),ds.lists[a].gotFields=!0;},!0,!0,'',a,'',function(){});},getListFields:function(a,c,b){ds.rest.getDataFromURI(c,function(c,d,e){ds.rest.lastSubCall={},ds.rest.lastSubCall.textStatus=d,ds.rest.lastSubCall.jqXHR=e,ds.lists[a].fields_def=c.d,ds.lists[a].gotFields=!0,ds.util.log('Got field definitions for list |'+a+'|'),typeof b==='function'&&b(c,d,e);},!0,!0);}}},util:{log:function(b,a){if(a===void 0)var a=!1;if(ds.stor.session.bDebug===!0||a===!0)try{console.log(b);}catch(err){}},getFunctionCode:function(a){return typeof a==='function'?a.toString():a;},findField:function(d,a,c){var b;return ds.$(ds.lists[d].fields_def.results).each(function(h,g){if(typeof a==='string'){if(g[a]===c)return b=g,!1;}else if(typeof a==='object'){var f=[];ds.$(a).each(function(){f.push(!1);});for(var e=0;e<a.length;e++){g[a[e]]===c[e]&&(f[e]=!0);var d=!0;if(ds.$(f).each(function(b,a){return a!==!0?(d=!1,!1):void 0;}),d===!0)break;}var d=!0;if(ds.$(f).each(function(b,a){return a!==!0?(d=!1,!1):void 0;}),d===!0)return b=g,!1;}}),b;},findList:function(b,f){var e;for(listName in ds.lists)if(typeof b==='string'){if(ds.lists[listName][b]===f){e=ds.lists[listName];break;}}else if(typeof b==='object'){var d=[];ds.$(b).each(function(){d.push(!1);});for(var c=0;c<b.length;c++){ds.lists[listName][b[c]]===f[c]&&(d[c]=!0);var a=!0;if(ds.$(d).each(function(c,b){return b!==!0?(a=!1,!1):void 0;}),a===!0)break;}var a=!0;if(ds.$(d).each(function(c,b){return b!==!0?(a=!1,!1):void 0;}),a===!0){e=ds.lists[listName];break;}}return e;},minifyJS:function(a){while(a.indexOf('    ')>=0)a=a.replace('    ','');while(a.indexOf('\n')>=0)a=a.replace('\n','');return a;},escapeJS:function(a){var d=20000;var b=0;var c=/([~\\]\")/g;while(a.indexOf(c)>=1)if(a.replace(c,'"'),b++,b>=d)break;return a;},appendToMain:function(a){return typeof a==='string'?ds.$('#contentBox').append(a):typeof a==='array'||typeof a==='object'?ds.$('#contentBox').append(a.join('')):void 0;},getAllListsRelatedToTasks:function(){var a=[];var b=ds.util.findList('Id',_spPageContextInfo.pageListId.replace('{','').replace('}','')).Id;masterListGUID=b;for(list in ds.lists)if(!ds.lists[list]===!1&&!ds.lists[list].fields_def===!1)for(field in ds.lists[list].fields_def.results)if(!ds.lists[list].fields_def.results[field].LookupList===!1){var c='{'+masterListGUID+'}';ds.lists[list].fields_def.results[field].LookupList.toString().toUpperCase()===c.toUpperCase()&&a.indexOf(list)<0&&a.push(list);}return ds.stor.relatedRecordsLists=a,a;},getPageRelativeURL:function(){var a=_spPageContextInfo.serverRequestPath;return a;},getSiteRegionalTimeZone:function(){return ds.stor.spCSOM.clientContext=new SP.ClientContext(),ds.stor.spCSOM.web=ds.stor.spCSOM.clientContext.get_web(),ds.stor.spCSOM.culture=ds.stor.spCSOM.web.get_regionalSettings(),ds.stor.spCSOM.clientContext.load(ds.stor.spCSOM.culture),ds.stor.spCSOM.tz=ds.stor.spCSOM.culture.get_timeZone(),ds.stor.spCSOM.clientContext.load(ds.stor.spCSOM.tz),ds.stor.spCSOM.clientContext.executeQueryAsync(function(){ds.stor.spCSOM.siteTzId=ds.stor.spCSOM.tz.$5_0.$H_0.Id,ds.stor.spCSOM.siteTzDesc=ds.stor.spCSOM.tz.$5_0.$H_0.Description,ds.stor.spCSOM.siteTzInformation=ds.stor.spCSOM.tz.$5_0.$H_0.Information;}),ds.stor.spCSOM.clientContext.dispose(),ds.stor.spCSOM.siteTzDescription;},generateICSDownloadForTaskMeetings:function(){ds.rest.getDataFromURI(ds.lists.taskmeetings.Items.__deferred.uri,function(d,g,h){ds.lists.taskmeetings.items=ds.lists.taskmeetings.items||{},ds.lists.taskmeetings.items.results=d.d.results;for(item in ds.lists.taskmeetings.items.results){var a=ds.p.root+'_vti_bin/owssvr.dll?CS=109&Cmd=Display&List=';a+=ds.lists.taskmeetings.Id.toUpperCase(),a+='&CacheControl=1&ID=',a+=ds.lists.taskmeetings.items.results[item].Id,a+='&Using=event.ics',ds.util.log('ICS = '+a);var e=ds.$(".ms-formlabel:contains('Title')").parent().children('.ms-formbody').text().trim();var f=ds.$(".ms-formlabel:contains('TaskID')").parent().find('.ms-formbody a').text();var b=ds.$(".ms-formlabel:contains('TaskID')").parent().find('.ms-formbody a').prop('href');b=GetUrlKeyValue('ID',!0,b);var c={DownloadICS:a};ds.rest.list.item.update(c,'TaskMeetings',ds.lists.taskmeetings.items.results[item].Id,function(){ds.util.log('Updated item');});}});},lookupUserBySPID:function(a,c,b){$.ajax({url:ds.p.root+'_layouts/15/userdisp.aspx?ID='+a,type:'GET',dataType:'html',async:!0,success:function(d,f,g){var e=$(d).find(".ms-formlabel:contains('Name')").parent().find('.ms-formbody').text().trim();ds.stor.users=ds.stor.users||{},ds.stor.users[a]={},ds.stor.users[a].Name=$(d).find(".ms-formlabel:contains('Name')").parent().find('.ms-formbody').text().trim(),c.push(e),typeof b==='function'&&b(d,f,g);}});},checkIfBaseListsExist:function(){ds.$(ds.stor.listNames).each(function(c,b){var a=b.toString().toLowerCase();ds.lists[a]===void 0?(ds.util.log('List name |'+a+'| not found'),ds.util.appendToMain('<div>List name |'+a+'| not found... will attempt to create it</div>'),ds.rest.list.create(ds.stor.listTemplates.GenericList,b.toString(),'Testing rest list create',function(b,c,a){ds.util.appendToMain('<div>List name |'+sListName+'| successfully created</div>'),ds.rest.list.addField(a.responseJSON.d.Id,'TaskID',ds.stor.fieldType.Lookup,!1,!1,'TaskID',ds.lists.tasks.Id,function(a,b,c){ds.util.appendToMain('<div>Added field |'+title+'| to list with GUID |'+listGUID+'|</div>'),ds.util.log('Done adding field to list');});})):(ds.util.log('List name |'+a+'| WAS found'),ds.util.appendToMain('<div>List name |'+a+'| WAS found</div>'));});},checkIfAllListDefsRetrieved:function(c,b){var a=!0;for(e in ds.lists)if(ds.lists[e]!==void 0)if(ds.lists[e].gotDef===!0)if(c===!0)if(ds.lists[e].gotFields===!0)ds.util.log('List |'+ds.lists[e].Title+'| and its fields have been retrieved');else{switch(e){case'apppackages':ds.util.log('List |'+ds.lists[e].Title+"| has been retrieved, but we don't care about its fields");break;case'userinformationlist':ds.util.log('List |'+ds.lists[e].Title+"| has been retrieved, but we don't care about its fields");break;default:ds.util.log('List |'+ds.lists[e].Title+"| is retrieved, but we don't have the fields we're looking for",!0);a=!1;}if(a===!1)break;}else ds.util.log('List |'+ds.lists[e].Title+"| has been retrieved, but we don't care about its fields");else{ds.util.log('List |'+ds.lists[e].Title+'| has not yet been retrieved',!0),a=!1;break;}else{ds.util.log('List |'+ds.lists[e].Title+'| is somehow undefined?',!0),a=!1;break;}return a===!0&&(ds.util.log('ds.util.checkIfAllListDefsRetrieved function returning true',!0),typeof b==='function'&&b()),a;},getSettingsForCurrentPage:function(afterFx,bExecuteMasterInit){if(typeof bExecuteMasterInit==='undefined')var bExecuteMasterInit=!1;var restURL;ds.lists.dsformsettings!==void 0?restURL=ds.lists.dsformsettings.Items.__deferred.uri:(restURL=ds.p.root+ds.p.rest.lists2013+"/GetByTitle('dsformsettings')",ds.rest.getDataFromURI(restURL,function(b,d,e){var c=b.d.Id;var a=b.d.Title.replace(' ','').replace(' ','').toLowerCase();ds.lists[a]=b.d,ds.lists[a].gotDef=!0,ds.util.log('Got list definition for list |'+a+'|'),ds.lists[a].gotFields=!1,ds.util.log('Expanding list definition for list |'+a+'|'),ds.rest.coll.expandListDef(a,ds.p.root+ds.p.rest.lists2013+"('"+c+"')",function(){ds.lists[a].gotFields=!0;});},!1,!0)),restURL=ds.lists.dsformsettings.Items.__deferred.uri+"?$filter=Title eq '"+ds.p.pageListName+"' and FormNameURL eq '"+ds.p.pageFormName+"'&$select=Id,Title,FormNameURL,blbRelRecs",ds.rest.getDataFromURI(restURL,function(data,textStaus,jqXHR){if(data.d.results.length>0){if(ds.stor.formSettings=data.d.results,ds.lists.dsformsettings.items=ds.lists.dsformsettings.items||{},ds.lists.dsformsettings.items.results=data.d.results,ds.stor.formSettings.length===1){if(ds.util.log('found settings for current form',!0),ds.stor.newRelated=ds.stor.newRelated||{},ds.stor.updateRelated=ds.stor.updateRelated||{},ds.stor.formSettings=JSON.parse(ds.stor.formSettings[0].blbRelRecs),ds.stor.existingFormSettings=!0,ds.stor.formSettings.relatedRecords!==void 0)for(var iFS=0;iFS<ds.stor.formSettings.relatedRecords.length;iFS++){var fx=function(i){try{eval('ds.stor.newRelated[ds.stor.formSettings.relatedRecords[i].listName] = '+ds.stor.formSettings.relatedRecords[i].psudoPopupSaveNewFx+';');}catch(err){}try{eval('ds.stor.updateRelated[ds.stor.formSettings.relatedRecords[i].listName] = '+ds.stor.formSettings.relatedRecords[i].psudoPopupSaveUpdateFx+';');}catch(err){}try{eval('ds.stor.formSettings.relatedRecords[i].psudoPopupSaveNewFx = '+ds.stor.formSettings.relatedRecords[i].psudoPopupSaveNewFx+';');}catch(err){}try{eval('ds.stor.formSettings.relatedRecords[i].psudoPopupSaveUpdateFx = '+ds.stor.formSettings.relatedRecords[i].psudoPopupSaveUpdateFx+';');}catch(err){}};fx(iFS);}if(ds.stor.formSettings.masterSettings!==void 0){try{eval('ds.stor.formSettings.masterSettings.initFx = '+ds.stor.formSettings.masterSettings.initFx+';');}catch(err){}try{eval('ds.stor.formSettings.masterSettings.afterFx = '+ds.stor.formSettings.masterSettings.afterFx+';');}catch(err){}bExecuteMasterInit===!0&&(ds.util.log('Attempting to run ds.stor.formSettings.masterSettings.initFx',!0),typeof ds.stor.formSettings.masterSettings.initFx==='function'&&ds.stor.formSettings.masterSettings.initFx(),typeof ds.stor.formSettings.masterSettings.afterFx==='function'&&ds.stor.formSettings.masterSettings.afterFx());}}}else ds.util.log('no settings exist for the current page... returning a empty settings object',!0),ds.stor.existingFormSettings=!1,ds.stor.formSettings={masterSettings:{hideAddRelatedRecordButtons:!0,hideFilterTab:!0,initFx:'function() {}',afterFx:'function() {}'},relatedRecords:[]};typeof afterFx==='function'&&afterFx(ds.stor.formSettings);});},getCurrentTaskDetails:function(a,b){ds.rest.lastCall={},ds.rest.getDataFromURI(ds.lists.tasks.Items.__deferred.uri+'('+GetUrlKeyValue('ID')+')',function(b,c,d){ds.rest.lastCall.data=b,ds.rest.lastCall.textStatus=c,ds.rest.lastCall.jqXHR=d,typeof a==='function'&&a(b,c,d);},b);},ifCurrentTaskAssignedToMe:function(b){var a=!1;return ds.util.getCurrentTaskDetails(function(c,d,e){!c.d.AssignedToId===!1?(a=c.d.AssignedToId.results.indexOf(ds.p.userID)>=0,typeof b==='function'&&a===!0&&b(c,d,e)):a=!1;},!0),a;},getListPermissions:function(a,b){ds.lists[a]===void 0?ds.rest.list.getDef(a,function(c,d,e){ds.rest.coll.expandListDef(a,ds.lists[a].__metadata.uri,function(c,d,e){typeof b==='function'&&b(ds.lists[a].EffectiveBasePermissions);});}):ds.lists[a].EffectiveBasePermissions===void 0?ds.rest.coll.expandListDef(a,ds.lists[a].__metadata.uri,function(c,d,e){typeof b==='function'&&b(ds.lists[a].EffectiveBasePermissions);}):typeof b==='function'&&b(ds.lists[a].EffectiveBasePermissions);},checkForItemEditAddDelete:function(c,a){var b=new SP.BasePermissions();return b.set(SP.PermissionKind.viewListItems),b.set(SP.PermissionKind.editListItems),b.set(SP.PermissionKind.addListItems),b.set(SP.PermissionKind.deleteListItems),_spPageContextInfo.userId===void 0?ds.lists[c].EffectiveBasePermissions.High<b.$5_1?(typeof a==='function'&&a(!0),!0):(typeof a==='function'&&a(!1),!1):ds.lists[c].EffectiveBasePermissions.High>b.$5_1?(typeof a==='function'&&a(!0),!0):(typeof a==='function'&&a(!1),!1);},conditionallyShowDsMagicConfigurationButton:function(){var a=ds.intvls.newIntvl('wf_list_dsformsettings');ds.intvls[a].pauseMS=100,ds.intvls[a].forFx='ds.util.conditionallyShowDsMagicConfigurationButton()',ds.intvls[a].timeoutMS=10000,ds.intvls[a].doWorkFx=function(){return ds.lists.dsformsettings!==void 0&&ds.lists.dsformsettings.EffectiveBasePermissions.High!==void 0&&(ds.intvls[a].bDone=!0),ds.intvls[a].bDone;},ds.intvls[a].successFx=function(){ds.util.log('ds.intvls.'+a+'.intvl... SUCCESSFULLY FINISHED WAITING',!0),ds.stor.session.userEditDsFormSettingsAccess=ds.util.checkForItemEditAddDelete('dsformsettings',function(a){a===!0&&(ds.util.appendToMain("<table class='ds-magic-enterSetupButton-wrapper' border='0' cellspacing='0' cellpadding='0'><tbody><tr><td class='ds-magic-enterSetupButton' title='Enter ds magic setup'><i class='fa fa-ellipsis-v'></i></td></tr></tbody></table>"),ds.$('.ds-magic-enterSetupButton').click(function(){ds.configure.load();}));});},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS);},getListFormFieldByDisplayName:function(a){var b=ds.$(".ms-formlabel:contains('"+a+"')").parents('tr').eq(0);var c=b.children('.ms-formbody').find("TEXTAREA[title^='"+a+"'],INPUT[title^='"+a+"'],SELECT[title^='"+a+"']");return c;},getListFormFieldValueByDisplayName:function(c){var e=ds.$(".ms-formlabel:contains('"+c+"')").parents('tr').eq(0);var a=e.children('.ms-formbody').find("TEXTAREA[title^='"+c+"'],INPUT[title^='"+c+"'],SELECT[title^='"+c+"']");if(a[0].tagName.toUpperCase()==='SELECT')if(a.prop('multiple')===!0){var b=a.find('OPTION[selected]');var d=[];return b.each(function(){d.push([ds.$(this).val(),ds.$(this).text()]);}),d;}else{var b=a.find('OPTION[selected]');return[b.val(),b.text()];}else return a.val();},simulateBrowseTabClick:function(){document.getElementById('Ribbon.Read-title').firstElementChild.click();},isPageInEditMode:function(){var a=!1;try{a=document.forms.aspnetForm.MSOLayout_InDesignMode.value=='1';}catch(err){}try{a=document.forms.aspnetForm._wikiPageMode.value=='Edit';}catch(err){}return a;},getWPZByRowAndColumn:function(c,d){var a=['TABLE.ms-webpartPage-root > TBODY'];if(typeof c==='object'&&typeof d==='object')for(var b=0;b<c.length;b++)b>0&&a.push(' TABLE > TBODY'),a.push(' > TR:eq('+c[b]+') > TD:eq('+d[b]+')');else a.push(' > TR:eq('+c+') > TD:eq('+d+')');return a.push(' > .ms-webpart-zone'),ds.$(a.join(''));}},evts:{},intvls:{newIntvl:function(c){var b=new Date();var a=c+b.valueOf();return ds.intvls[a]===void 0?ds.intvls[a]={name:a,forFx:'',desc:'',intvl:null,pauseMS:123,counter:0,timeoutMS:10000,bDone:!1,loopingFx:function(){ds.intvls[a].counter=ds.intvls[a].counter+1,ds.intvls[a].doWorkFx(),ds.intvls[a].bDone===!0&&(ds.intvls[a].successFx(),clearInterval(ds.intvls[a].intvl)),ds.intvls[a].counter*ds.intvls[a].pauseMS>=ds.intvls[a].timeoutMS&&(ds.intvls[a].timeoutFx(),clearInterval(ds.intvls[a].intvl));},doWorkFx:function(){},successFx:function(){ds.util.log('ds.intvls.'+a+'.intvl... SUCCESSFULLY FINISHED WAITING',!0);},timeoutFx:function(){ds.util.log('ds.intvls.'+a+'.intvl... ERROR! TIMED OUT WAITING',!0);}}:(ds.util.log('An interval with that name ('+a+') already exists!',!0),alert('An interval with that name ('+a+') already exists!')),a;},wfIdleToLoadResources:{intvl:null,pauseMS:73,timeoutMS:1100,counter:0,loopingFx:function(){var a=!1;try{ExecuteOrDelayUntilScriptLoaded(function(){window.document.readyState==='complete'&&ds.stor.session.idleTime>=ds.intvls.wfIdleToLoadResources.timeoutMS/2&&(a=!0);},'sp.js');}catch(err){}a===!0?(ds.intvls.wfIdleToLoadResources.onSuccessFx(),clearInterval(ds.intvls.wfIdleToLoadResources.intvl)):ds.intvls.wfIdleToLoadResources.pauseMS*ds.intvls.wfIdleToLoadResources.counter>=ds.intvls.wfIdleToLoadResources.timeoutMS?(ds.intvls.wfIdleToLoadResources.onTimeoutFx(),clearInterval(ds.intvls.wfIdleToLoadResources.intvl)):ds.intvls.wfIdleToLoadResources.counter=ds.intvls.wfIdleToLoadResources.counter+1,ds.stor.session.idleTime+=ds.intvls.wfIdleToLoadResources.pauseMS;},onTimeoutFx:function(){ds.util.log('wfIdleToLoadResources... Detected user idle time... will load additional content in anticipation of the next user request to speed things up',!0),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-SPTZs.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-listTemplates.js',function(){ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-fieldType.js',function(){ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-createLists.js');});}),ds.$.getCachedScript(ds.p.cdn.js.moment,function(){ds.$.getCachedScript(ds.p.cdn.js.momentTz);}),ds.$.getCachedScript(ds.p.cdn.js.fontAwesome),ds.$.getCachedScript(ds.p.cdn.js.feedEk),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-tabs.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-psudoPopup.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-accordion.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-codeEditor.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-contextMenu.js'),ds.stor.session.bOnlyGetListsWhenTold===!1?ds.rest.coll.getLists(!0,function(){ds.intvls.wfAllListsAndFields.intvl=setInterval(ds.intvls.wfAllListsAndFields.loopingFx,ds.intvls.wfAllListsAndFields.pauseMS);}):ds.util.getSettingsForCurrentPage(function(formSettings){try{eval('formSettings.masterSettings.initFx = '+formSettings.masterSettings.initFx+';'),formSettings.masterSettings.initFx();}catch(err){}}),ds.pages.all(),typeof ds.intvls.wfIdleToLoadResources.afterFx==='function'&&ds.intvls.wfIdleToLoadResources.afterFx(),window.clearInterval(ds.intvls.wfIdleToLoadResources.intvl);},onSuccessFx:function(){ds.util.log('wfIdleToLoadResources... Detected that sp.ribbon.js is loaded and document.readyState is complete... will load additional content in anticipation of the next user request to speed things up'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-SPTZs.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-listTemplates.js',function(){ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-fieldType.js',function(){ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-stor-createLists.js');});}),ds.$.getCachedScript(ds.p.cdn.js.moment,function(){ds.$.getCachedScript(ds.p.cdn.js.momentTz);}),ds.$.getCachedScript(ds.p.cdn.js.fontAwesome),ds.$.getCachedScript(ds.p.cdn.js.feedEk),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-tabs.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-psudoPopup.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-accordion.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-codeEditor.js'),ds.$.getCachedScript(ds.p.root+'Style%20Library/DS_Namespace-1_ds-controls-contextMenu.js'),ds.util.log('wfIdleToLoadResources... Finished load of additional content in anticipation of the next user request to speed things up... conditionally kicking off lists and fields retrieval'),ds.stor.session.bOnlyGetListsWhenTold===!1?ds.rest.coll.getLists(!0,function(){ds.intvls.wfAllListsAndFields.intvl=setInterval(ds.intvls.wfAllListsAndFields.loopingFx,ds.intvls.wfAllListsAndFields.pauseMS);}):ds.util.getSettingsForCurrentPage(function(a){},!0),ds.pages.all(),typeof ds.intvls.wfIdleToLoadResources.afterFx==='function'&&ds.intvls.wfIdleToLoadResources.afterFx(),window.clearInterval(ds.intvls.wfIdleToLoadResources.intvl);},afterFx:function(){}},wfAllListsAndFields:{intvl:null,pauseMS:500,timeoutMS:8000,counter:0,loopingFx:function(){var a=!1;try{a=ds.util.checkIfAllListDefsRetrieved(!0);}catch(err){}a===!0?(ds.intvls.wfAllListsAndFields.onSuccessFx(),clearInterval(ds.intvls.wfAllListsAndFields.intvl)):ds.intvls.wfAllListsAndFields.pauseMS*ds.intvls.wfAllListsAndFields.counter>=ds.intvls.wfAllListsAndFields.timeoutMS?(ds.intvls.wfAllListsAndFields.onTimeoutFx(),clearInterval(ds.intvls.wfAllListsAndFields.intvl)):ds.intvls.wfAllListsAndFields.counter=ds.intvls.wfAllListsAndFields.counter+1;},onTimeoutFx:function(){ds.util.log('wfAllListsAndFields... timeout waiting for all lists and fields to be retrieved'),window.clearInterval(ds.intvls.wfAllListsAndFields.intvl);},onSuccessFx:function(){ds.util.log('wfAllListsAndFields... Detected that all lists and fields have been retrieved... Checking if we need to load tabbed interface',!0),ds.util.getSettingsForCurrentPage(function(formSettings){try{eval('formSettings.masterSettings.initFx = '+formSettings.masterSettings.initFx+';'),formSettings.masterSettings.initFx();}catch(err){}}),setTimeout(ds.util.conditionallyShowDsMagicConfigurationButton,1300),window.clearInterval(ds.intvls.wfAllListsAndFields.intvl);}}},controls:{accordion:{},psudoButton:{gen:function(e,f,b,d){var a=new Array();if(a.push("<DIV class='ds-psudoButton' id='"+e+"'>"),a.push("<table align='center' width='auto' border='0' cellspacing='0' cellpadding='0'>"),a.push('<tbody>'),a.push('<tr>'),typeof b==='string')a.push("<td><i class='fa "+b+' '+d+"'></i></td>");else if(typeof b==='object')for(var c=0;c<b.length;c++)a.push("<td><i class='fa "+b[c]+' '+d[c]+"'></i></td>");return a.push('<td>'+f+'</td>'),a.push('</tr>'),a.push('</tbody>'),a.push('</table>'),a.push('</DIV>'),a.join('');}},codeEditor:{},psudoPopup:{},tabs:{},contextMenu:{},chart:{init:function(a){ds.$.ajax({url:ds.p.root+'Style%20Library/ds_html_chart.html',method:'GET',dataType:'html'}).done(function(c,d,b){a===void 0?ds.util.appendToMain(b.responseText):ds.$(a).append(b.responseText);});}}},pages:{all:function(){ds.util.log('Setting up event handlers used on all pages',!0),ds.$('BODY').on('keypress',function(a){ds.stor.session.idleTime=0,ds.evts.keyPressBody=a;}),ds.$('BODY').on('mousedown',function(a){ds.stor.session.idleTime=0,ds.evts.mouseDownBody=a;}),ds.$('BODY').on('mouseup',function(a){ds.stor.session.idleTime=0,ds.evts.mouseUpBody=a;}),ds.$('BODY').on('mousemove',function(a){ds.stor.session.idleTime=0,ds.evts.mouseMoveBody=a,ds.stor.session.mouseX=a.clientX,ds.stor.session.mouseY=a.clientY;}),ds.$(window).on('blur',function(a){ds.stor.session.windowFocus=!1,ds.stor.session.idleTime=ds.intvls.wfIdleToLoadResources.timeoutMS+1,ds.evts.blurWindow=a;}),ds.$(window).on('focus',function(a){ds.stor.session.windowFocus=!0,ds.evts.focusWindow=a;}),$('#DeltaSiteLogo').empty().append("<div class='ds-magic-logo-wrapper' unselectable='on'><span class='ds-magic-logo-content-letter' unselectable='on'>d</span><span class='ds-magic-logo-content-letter' unselectable='on'>s</span><span class='ds-magic-logo-content-fa' unselectable='on'><i class='fa fa-magic'></i></span></div>");}},configure:{load:function(){ds.stor.configGui={};var a=ds.intvls.newIntvl('dsMagicConfigInit');ds.intvls[a].successFx=function(){ds.configure.init();},ds.intvls[a].intvl=setInterval(ds.intvls[a].loopingFx,ds.intvls[a].pauseMS),ds.controls.codeEditor.addScripts(function(){ds.$.ajax({url:ds.p.root+'Style%20Library/ds_html_config_dsmagic_gui.html',method:'GET',dataType:'html'}).done(function(b){ds.util.log('appending initial code for dsmagic configuration',!0),ds.util.appendToMain(b),ds.$('.ds-config-gui').css({position:'fixed',width:'80%',height:'70%',bottom:'5%',right:'10%'}),ds.$('.ds-config-gui').wrap("<div class='ds-psudoPopupWrapper'></div>"),ds.intvls[a].bDone=!0;});});},init:function(){ds.stor.configGui.sectionHeader=ds.$('.ds-config-section-header').eq(0).clone(!0),ds.$('.ds-config-section-header').eq(0).remove(),ds.stor.configGui.sectionContent=ds.$('.ds-config-section-wrapper').eq(0).clone(!0),ds.$('.ds-config-section-wrapper').eq(0).remove();var a=1;ds.util.getSettingsForCurrentPage(function(d){try{console.dir(d);}catch(err){}var f=d.masterSettings;if(d.relatedRecords!==void 0){var c=ds.$(ds.stor.configGui.sectionHeader).clone(!0);c.find('.ds-config-section-header-name').text('Related Records Tabs UI'),c.find('.ds-config-section-index').text(a),ds.$('.ds-config-gui').append(c);var e=ds.$(ds.stor.configGui.sectionContent).clone(!0);e.html("<div id='placeholderRelatedRecordsTabsUI'></div>"),ds.$('.ds-config-gui').append(e);var b=ds.intvls.newIntvl('tabsConfigInit');ds.intvls[b].successFx=function(){setTimeout(ds.controls.tabs.configure.init,15);},ds.intvls[b].intvl=setInterval(ds.intvls[b].loopingFx,ds.intvls[b].pauseMS),ds.controls.codeEditor.addScripts(function(){ds.$.get(ds.p.root+'Style%20Library/ds_html_config_related_records_gui.html').done(function(a){ds.util.log('appending raw HTML for tabs config',!0),ds.$('#placeholderRelatedRecordsTabsUI').replaceWith(a),ds.$('.ds-config-gui-tabs').css({border:'0px hidden transparent','background-color':'transparent',width:'99%'}),ds.$('.ds-tabs-config-btn-save').parents('TD').eq(0).remove(),ds.$('.ds-tabs-config-btn-cancel').parents('TD').eq(0).remove(),ds.$('.ds-tabs-config-btn-collapseListForm').parents('TD').eq(0).remove(),ds.$('.ds-config-gui-tabs .ds-config-tab-header.masterSettings, .ds-config-gui-tabs .ds-config-tab-wrapper.masterSettings').remove(),ds.$('.ds-tabs-config-gui-top-menu .ds-tabs-config-btn').css('font-size','0.9em'),ds.$('.ds-tabs-config-gui-top-menu > TABLE:first-child').attr('align','right'),ds.intvls[b].bDone=!0;});});}a++,ds.$('.ds-config-section-wrapper').slideUp(),ds.$('.ds-config-section-header-name').click(function(){ds.$(this).parents('.ds-config-section-header').next().css('display')!=='none'?ds.$(this).parents('.ds-config-section-header').next().slideUp():ds.$(this).parents('.ds-config-section-header').next().slideDown();});});},events:{}},$:$,onLoad:setTimeout(function(){ds.util.log('DS Namespace loaded',!0),ds.$.support.cors=!0,ds.$.getCachedScript=function(c,b,a){return a=ds.$.extend(a||{},{dataType:'script',async:!0,cache:!0,url:c}),typeof b==='function'?ds.$.ajax(a).done(function(){b();}):ds.$.ajax(a);},ds.$.getPageWithActiveContent=function(c,b,a){if(a===void 0)var a=!1;return b=ds.$.extend(b||{},{dataType:'html',async:!0,cache:a,url:c}),ds.$.ajax(b);},ds.$.ajaxSetup({contentType:'application/json;odata=verbose',headers:{accept:'application/json;odata=verbose','content-type':'application/json;odata=verbose','X-RequestDigest':$('#__REQUESTDIGEST').val()}}),ds.util.log('DS Namespace jQuery extended with additional functions'),ds.$(document).ready(function(){ds.util.log('Document.ready event fired',!0),ds.util.isPageInEditMode()===!1&&(ds.intvls.wfIdleToLoadResources.intvl=setInterval(ds.intvls.wfIdleToLoadResources.loopingFx,ds.intvls.wfIdleToLoadResources.pauseMS)),ds.$(document).off('ready');});},100)};